# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ç—Ä–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É)

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /opt/newsagent

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose -f docker-compose.prod.yml ps

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (–∏—â–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø—Ä–æ –º–µ—Ç—Ä–∏–∫–∏)
docker compose -f docker-compose.prod.yml logs newsagent | grep -i "metrics\|Prometheus"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec newsagent-bot curl -s http://localhost:8000/metrics | head -20

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ —Å —Ö–æ—Å—Ç–∞
curl http://localhost:8000/metrics | head -20
```

## –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
cd /opt/newsagent
docker compose -f docker-compose.prod.yml ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up` –∏ –ø–æ—Ä—Ç `0.0.0.0:8000->8000/tcp`

### 2. –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose -f docker-compose.prod.yml logs --tail=50 newsagent
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `üìä Prometheus metrics endpoint –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000` - –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã ‚úÖ
- –û—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏–∑–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker exec newsagent-bot curl -s http://localhost:8000/metrics
```

**–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø—É—â–µ–Ω—ã, –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ø—Ä–æ–±—Ä–æ—Å–µ –ø–æ—Ä—Ç–∞
**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ —Å —Ö–æ—Å—Ç–∞

```bash
curl -v http://localhost:8000/metrics
```

**–ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ ‚úÖ
**–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ –∏ firewall

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cat .env
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**
- `TELEGRAM_BOT_TOKEN=...` (–Ω–µ –ø—É—Å—Ç–æ–µ)
- `TELEGRAM_CHAT_ID=...` (–Ω–µ –ø—É—Å—Ç–æ–µ)
- `METRICS_PORT=8000` (–∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —Ç–æ–≥–¥–∞ –±—É–¥–µ—Ç 8000)

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker exec newsagent-bot ps aux
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ—Ü–µ—Å—Å `python simple_bot.py`

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

```bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec newsagent-bot netstat -tlnp 2>/dev/null | grep 8000
# –∏–ª–∏
docker exec newsagent-bot ss -tlnp 2>/dev/null | grep 8000

# –ù–∞ —Ö–æ—Å—Ç–µ
netstat -tlnp 2>/dev/null | grep 8000
# –∏–ª–∏
ss -tlnp 2>/dev/null | grep 8000
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Ä—Ç 8000 –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å—Å—è

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–∞ –≤ docker-compose

```bash
grep -A 5 "ports:" docker-compose.prod.yml
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `- "8000:8000"` –∏–ª–∏ `${METRICS_PORT:-8000}:8000`

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall

```bash
sudo ufw status
```

**–ï—Å–ª–∏ firewall –∞–∫—Ç–∏–≤–µ–Ω:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç:
```bash
sudo ufw allow 8000/tcp
```

### 10. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose -f docker-compose.prod.yml restart newsagent
docker compose -f docker-compose.prod.yml logs -f newsagent
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

```bash
# –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –±–æ—Ç–∞
curl -s http://localhost:8000/metrics | grep telegram_bot

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥
curl -s http://localhost:8000/metrics | grep telegram_bot_commands_total

# –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
curl -s http://localhost:8000/metrics | grep telegram_bot_uptime_seconds

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
curl -s http://localhost:8000/metrics | grep telegram_bot_messages_sent_total
```

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—É—Å—Ç—ã–µ

–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—è–≤—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±–æ—Ç –ø–æ–ª—É—á–∏—Ç –∫–æ–º–∞–Ω–¥—ã:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –±–æ—Ç—É –≤ Telegram: `/start` –∏–ª–∏ `/help`
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–Ω–æ–≤–∞:
```bash
curl -s http://localhost:8000/metrics | grep telegram_bot_commands_total
```

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused" –ø—Ä–∏ curl

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
docker compose -f docker-compose.prod.yml ps

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose -f docker-compose.prod.yml logs newsagent

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker compose -f docker-compose.prod.yml restart newsagent
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–æ –Ω–µ —Å —Ö–æ—Å—Ç–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞
grep -A 5 "ports:" docker-compose.prod.yml

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
sudo ufw status
sudo ufw allow 8000/tcp

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç —Å–ª—É—à–∞–µ—Ç—Å—è
netstat -tlnp | grep 8000
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose -f docker-compose.prod.yml logs newsagent

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
grep -E "TELEGRAM_BOT_TOKEN|TELEGRAM_CHAT_ID" .env
```

## –û–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –í—Å–µ –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ
cd /opt/newsagent && \
echo "=== –°—Ç–∞—Ç—É—Å ===" && docker compose -f docker-compose.prod.yml ps && \
echo "=== –õ–æ–≥–∏ (–º–µ—Ç—Ä–∏–∫–∏) ===" && docker compose -f docker-compose.prod.yml logs newsagent | grep -i metric | tail -5 && \
echo "=== –ú–µ—Ç—Ä–∏–∫–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ===" && docker exec newsagent-bot curl -s http://localhost:8000/metrics | head -5 && \
echo "=== –ú–µ—Ç—Ä–∏–∫–∏ —Å —Ö–æ—Å—Ç–∞ ===" && curl -s http://localhost:8000/metrics | head -5
```

